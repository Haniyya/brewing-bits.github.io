<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>A way to split up big merge- or pull-requests | Brewing Bits</title>
<meta name="description" content="Working in a team, and having someone review your code, can take quite awhile. Especially if your Merge- or Pull-Request makes a lot of changes. HereI’ll sho...">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="cache-control" content="public">
<meta http-equiv="pragma" content="public">
<meta name="keywords" content="Typing, Theme, Jekyll">
<meta name="author" content="Paul">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="Brewing Bits">
<meta property="og:type" content="WebSite">
<meta property="og:url" content="https://haniyya.github.io/blog/splitting-big-merges/">
<meta property="og:description" content="Brewing delicious code for you.">
<meta property="og:title" content="A way to split up big merge- or pull-requests - Brewing Bits">
<link rel="canonical" href="https://haniyya.github.io/blog/splitting-big-merges/">
<link rel="alternate" type="application/rss+xml" title="Brewing Bits" href="https://haniyya.github.io/feed.xml"> <script type="application/ld+json"> {"@context": "http://schema.org", "@type": "WebSite", "name": "Paul", "headline": "Brewing Bits", "author": {"@type": "Person", "name": {"Brewing Bits"}}, "description": "Brewing delicious code for you.", "url": "https://haniyya.github.io"} </script> <script type="text/javascript"> var GLOBAL_BASEURL = "https://haniyya.github.io"; </script><link rel="icon" type="image/png" sizes="32x32" href="https://haniyya.github.io/assets/images/favicon/favicon-32x32.png">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,600i,700,700i,800,800i" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet">
<link rel="stylesheet" href="https://haniyya.github.io/assets/stylesheets/main.css"> <script> var url_site = "https://haniyya.github.io", url_production = "http://localhost:4000"; if (url_site != url_production) { (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-106066883-1', 'auto'); ga('set', 'forceSSL', true); ga('send', 'pageview'); }; </script>
</head>
<body>
<div class="main" id="top">
<div class="container wrapper"><div class="row">
<div class="col-sm-3 sidebar">
<div class="row avatar"> <a href="https://haniyya.github.io/"> <img class="img-responsive center-block avatar-img" src="https://haniyya.github.io/assets/images/avatar/logo_export.svg" height="165" width="165" alt="Brewing Bits"> </a>
</div>
<div class="row header"><h2><a href="https://haniyya.github.io">Grab a seat, <br> have a cup. </a></h2></div>
<div class="row menu">
<ul>
<li class="nav-item"> <i class="fa fa-home" aria-hidden="true"></i> <a href="https://haniyya.github.io/">Hello</a>
</li>
<hr class="breakline">
<li class="nav-item"> <i class="fa fa-edit" aria-hidden="true"></i> <a href="https://haniyya.github.io/blog/">Blog</a>
</li>
<li class="nav-item"> <i class="fa fa-search" aria-hidden="true"></i> <a href="https://haniyya.github.io/blog/search/">Search</a>
</li>
<li class="nav-item"> <i class="fa fa-tags" aria-hidden="true"></i> <a href="https://haniyya.github.io/blog/tags/">Tags</a>
</li>
<li class="nav-item"> <i class="fa fa-briefcase" aria-hidden="true"></i> <a href="https://haniyya.github.io/projects/" onclick="ga('send', 'event', 'linkTo', 'https://haniyya.github.io/projects/', 'Projects');">Projects</a>
</li>
<li class="nav-item"> <i class="fa fa-file-text-o" aria-hidden="true"></i> <a href="https://haniyya.github.io/resume/" onclick="ga('send', 'event', 'linkTo', 'https://haniyya.github.io/resume/', 'Resume');">Resume</a>
</li>
<li class="nav-item"> <i class="fa fa-rss" aria-hidden="true"></i> <a href="https://haniyya.github.io/feed.xml">Feed</a>
</li>
<li class="nav-item"> <i class="fa fa-envelope" aria-hidden="true"></i> <a href="https://haniyya.github.io/contact/">Contact</a>
</li>
</ul>
<div class="socials"><div class="row">
<p></p>
<p>Follow Me!</p>
<div id="github" class="col-sm-4 columns"> <a href="https://github.com/Haniyya" target="_blank" title="GitHub" onclick="ga('send', 'event', 'linkTo', 'GitHub', 'Social Network', {useBeacon: true});"> <i class="fa fa-github icon" aria-hidden="true"></i> </a>
</div>
<div id="twitter" class="col-sm-4 columns"> <a href="https://twitter.com/BrewingBits/" target="_blank" title="Twitter" onclick="ga('send', 'event', 'linkTo', 'Twitter', 'Social Network', {useBeacon: true});"> <i class="fa fa-twitter icon" aria-hidden="true"></i> </a>
</div>
<div id="email" class="col-sm-4 columns"> <a href="https://tinyletter.com/BrewingBits" target="_blank" title="Email" onclick="ga('send', 'event', 'linkTo', 'Email', 'Social Network', {useBeacon: true});"> <i class="fa fa-envelope icon" aria-hidden="true"></i> </a>
</div>
</div></div>
</div>
<form class="tinyletter" style="border:1px solid #ccc;padding:3px;text-align:center;" action="https://tinyletter.com/BrewingBits" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/BrewingBits', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
<p><label for="tlemail">I won't pester you much! Promise!</label></p>
<p><input type="text" style="width:140px" name="email" id="tlemail"></p>
<input type="hidden" value="1" name="embed"><input type="submit" value="Subscribe"><p><a href="https://tinyletter.com" target="_blank">powered by TinyLetter</a></p>
</form>
</div>
<div class="col-sm-9 content-main"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><div class="row title"><h1>A way to split up big merge- or pull-requests</h1></div>
<div class="row meta" datetime="2017-09-10"> <time class="col-sm-6 datetime"> <i class="fa fa-calendar" aria-hidden="true"></i><span class="text tmargin "> September 10, 2017 </span> </time><div class="col-sm-6 count-comments"> <span class="wrap"><i class="fa fa-comments" aria-hidden="true"></i> <a href="#comments" data-disqus-identifier="/blog/splitting-big-merges/">0</a></span>
</div>
</div>
<div class="row tag-list"> <i class="fa fa-tags" aria-hidden="true"></i> <a href="https://haniyya.github.io/blog/tags//git">git</a> <a href="https://haniyya.github.io/blog/tags//vim">vim</a> <a href="https://haniyya.github.io/blog/tags//rails">rails</a> <a href="https://haniyya.github.io/blog/tags//programming">programming</a>
</div>
<div class="row"> Read this in "about 9 minutes".</div>
<div class="row content">
<p>Working in a team, and having someone review your code, can take quite a while. Especially if your Merge- or Pull-Request makes a lot of changes. Here I’ll show a way to split one big merge request into several small, easy to review ones.</p>
<ul id="markdown-toc">
<li><a href="#what-well-use" id="markdown-toc-what-well-use">What we’ll use</a></li>
<li><a href="#the-problem" id="markdown-toc-the-problem">The problem</a></li>
<li>
<a href="#the-solution" id="markdown-toc-the-solution">The solution</a><ul>
<li><a href="#starting-the-rebase" id="markdown-toc-starting-the-rebase">Starting the rebase</a></li>
<li><a href="#getting-the-right-commits" id="markdown-toc-getting-the-right-commits">Getting the right commits</a></li>
<li><a href="#check-which-commits-you-actually-want" id="markdown-toc-check-which-commits-you-actually-want">Check which commits you actually want</a></li>
<li><a href="#the-todo-files-done" id="markdown-toc-the-todo-files-done">The TODO-file’s done</a></li>
<li><a href="#the-first-step-is-taken" id="markdown-toc-the-first-step-is-taken">The first step is taken</a></li>
</ul>
</li>
<li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>
<h2 id="what-well-use">What we’ll use</h2>
<p>In this article, we’ll use <a href="https://git-scm.com/">git</a> and, since it’s my preferred editor, <a href="https://vim.sourceforge.io/">vim</a> (or in my case <a href="https://neovim.io/">neovim</a> to be more specific). But I’ll show a way to do this independent of vim.</p>
<h2 id="the-problem">The problem</h2>
<p>Say you have a big feature prepared. You’ve written great, succinct code. But you had to touch a lot of files in your system. Now if your team uses some kind of project management like <a href="https://about.gitlab.com/">Gitlab</a> or <a href="https://github.com">Github</a>, you usually will submit your changes using a “Merge-Request” (or “Pull-Request” in the case of Github). Let’s make a more concrete example using a <code>rails</code> application:</p>
<ol>
<li>You added a new model and tests for it</li>
<li>You added a concern so that other models could use your new one.</li>
<li>You added a controller and routes for the new resource.</li>
<li>You changed the views to incorporate those changes.</li>
<li>You updated the documentation to include your changes.</li>
</ol>
<p>If you have all these changes on one branch, lets call it <code>112-new-feature-branch</code> (where <code>112</code> might be the issue number you are solving), you could have touched around 20+ files and added a few hundred lines of code (remember writing enough tests to make sure it all works). Not only will this take a long time to review, it will be a lot for your colleagues to grasp. To make it easier on them (and to encourage your colleagues to actually have a look at your changes), we are going to split this big branch into 5 distinct ones.</p>
<h2 id="the-solution">The solution</h2>
<p>If you follow some of <code>git</code>s best practices, you may have heard of</p>
<blockquote><p>Commit often, push once.</p></blockquote>
<p>This principal will be very useful now. First, open a new branch.</p>
<pre><code class="language-bash">$ git checkout -b 112-1-new-feature-model
</code></pre>
<p>You now have an ‘empty’ branch, based on the <code>master</code> branch of you repository. What we want to do, is isolate all changes related to the <code>model</code> we added in our branch.</p>
<h3 id="starting-the-rebase">Starting the rebase</h3>
<p>We are going to do that using the infamous <code>git rebase</code>:</p>
<pre><code class="language-bash">$ git rebase -i HEAD
</code></pre>
<p><strong>Note</strong>: The <code>-i</code> option here is short for <code>--interactive</code> and is important since it will open up a <code>rebase-todo</code> file for us.</p>
<p>What you should see now is something like this:</p>
<pre><code class="language-git">noop

# Rebase von [Commit-SHA]..[Commit-SHA] auf [Commit-SHA] (1 Kommando)
#
# Commands:
# p, pick = use commit
# r, reword = use commit, but edit the commit message
# e, edit = use commit, but stop for amending
# s, squash = use commit, but meld into previous commit
# f, fixup = like "squash", but discard this commit's log message
# x, exec = run command (the rest of the line) using shell
# d, drop = remove commit
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
</code></pre>
<p><strong>Note</strong>: You’ll have to set the <code>EDITOR</code> environment-variable beforehand (or just fix it in your <code>.bashrc</code>). Since I set <code>EDITOR=nvim</code> in my <code>.bashrc</code>, the command above opens up neovim for me.</p>
<h3 id="getting-the-right-commits">Getting the right commits</h3>
<p>Now comes the clever part, we are going to pick out all the commits we care about from <code>112-new-feature-branch</code> using the following command:</p>
<pre><code class="language-bash">git log --oneline --reverse HEAD..112-new-feature-branch -- app/models/ spec/models
</code></pre>
<p>Woah thats quite the line! Let’s dissect it first:</p>
<ol>
<li>
<code>git log</code> shows a log of what you have done in your project.</li>
<li>
<code>--online</code> formats the output from a few lines (including author and time of commit), to just “[sha-hash-of-commit] [description-of-commit]”</li>
<li>
<code>--reverse</code> reverses the log output chronologically (so oldest commit first, newest last).</li>
<li>
<code>112-new-feature-branch..HEAD</code> shows the difference in commits from your current branch (<code>HEAD</code>) and the branch you are interested in <code>112-new-feature-branch</code>.</li>
<li>
<code>-- app/models/ spec/models</code> Only show commits that changed files in <code>app/models/</code> or <code>spec/models</code> So that we confine the changes to our model and its tests.</li>
</ol>
<p>Now if you are using vim (or vi or neovim) you can put the results of this command directly into your <code>rebase-todo</code> (which was opened when starting the rebase) using the <code>:r</code> command like so:</p>
<pre><code class="language-bash">:r !git log --oneline --reverse HEAD..112-new-feature-branch -- app/models/
</code></pre>
<p>If you’re not using a vi-like editor, you can either pipe the results into your clipboard:</p>
<pre><code class="language-bash"># Assuming xsel is your clipboard of choice
git log --oneline --reverse HEAD..112-new-feature-branch -- app/models/ spec/models | xsel
</code></pre>
<p>Or put it into a new file:</p>
<pre><code class="language-bash"># Assuming there is a tmp directory for you to put stuff in.
git log --oneline --reverse HEAD..112-new-feature-branch -- app/models/ spec/models &gt; tmp/models-todo
</code></pre>
<p>and copy it from there manually.</p>
<h3 id="check-which-commits-you-actually-want">Check which commits you actually want</h3>
<p>Your ‘rebase-todo’ file now should look somewhat like this:</p>
<pre><code class="language-git">noop

c4f74d0 Added new model specs.
875f2f3 Added migration for new model.
88dbbd7 Added model for new model...
49ef7de Fixed a thing in specs.
be695ff Changed association.
1057525 Revert "Fixed a thing in specs."
3e638e9 Really fixed a thing in the specs.

# Rebase von [Commit-SHA]..[Commit-SHA] auf [Commit-SHA] (1 Kommando)
#
# Commands:
# p, pick = use commit
# r, reword = use commit, but edit the commit message
# e, edit = use commit, but stop for amending
# s, squash = use commit, but meld into previous commit
# f, fixup = like "squash", but discard this commit's log message
# x, exec = run command (the rest of the line) using shell
# d, drop = remove commit
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
</code></pre>
<p>Now you have a chance to go though your todo once again. First you should remove the <code>noop</code> from above, since you actually do something now. Second you should check the diffs of the sha-hashes.</p>
<p><strong>Note</strong>: If you are using vim, you might already have the <a href="https://github.com/tpope/vim-fugitive"><code>fugitive</code></a> plug-in. If you haven’t changed the standard configuration, you can just move your cursor over the sha-hashes and press <code>K</code> (note that its capitalized) to see the diff of that commit.</p>
<p>If you don’t have <code>fugitive</code> or don’t use vim, you can check the diff using <code>git show SHA-HASH</code> (ex: <code>git show c4f74d0</code>), which shows the commits data.</p>
<p>Now you can prepend and even rearrange the commits (<img class="emoji" title=":warning:" alt=":warning:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png" height="20" width="20" align="absmiddle"> Be careful rearranging or leaving out commits, you might have to fix conflicts later).</p>
<h3 id="the-todo-files-done">The TODO-file’s done</h3>
<p>When you’re done, the file should look like this:</p>
<pre><code class="language-git">pick c4f74d0 Added new model specs.
pick 875f2f3 Added migration for new model.
pick 88dbbd7 Added model for new model...
drop 49ef7de Fixed a thing in specs.
drop 1057525 Revert "Fixed a thing in specs."
pick be695ff Changed association.
pick 3e638e9 Really fixed a thing in the specs.

# Rebase von [Commit-SHA]..[Commit-SHA] auf [Commit-SHA] (1 Kommando)
#
# Commands:
# p, pick = use commit
# r, reword = use commit, but edit the commit message
# e, edit = use commit, but stop for amending
# s, squash = use commit, but meld into previous commit
# f, fixup = like "squash", but discard this commit's log message
# x, exec = run command (the rest of the line) using shell
# d, drop = remove commit
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
</code></pre>
<p>Now you can save and exit the editor and git will try to execute the rebase. If you have conflicts you can fix them just like you do with merges and then continue using <code>git rebase --continue</code>.</p>
<p>If you feel like something is going terribly wrong (for example you have a bunch of conflicts in just a few commits), you can abort the rebase using <code>git rebase --abort</code> and it will be like nothing ever happened.</p>
<h3 id="the-first-step-is-taken">The first step is taken</h3>
<p>That’s the basic idea. Now you can make a new branch from the one you’re on</p>
<pre><code class="language-bash">git checkout -b 112-2-new-feature-concern
</code></pre>
<p>And repeat the process</p>
<pre><code class="language-bash">git log --oneline --reverse HEAD..112-new-feature-branch -- app/concerns spec/concerns
</code></pre>
<p>Once you’ve made all the branches you want, you can check if you forgot any commits by doing</p>
<pre><code class="language-bash">git show-branch 112-5-new-feature-documentation 112-new-feature-branch
</code></pre>
<p>Which will show you the difference between those two branches. Once you have pushed all 5 branches, remember to arrange the merge requests in a way that one branch always merges into the previous, while the first (<code>112-1-new-feature-model</code> in our case), merges directly into master.</p>
<h2 id="conclusion">Conclusion</h2>
<p>To recap:</p>
<ol>
<li>Start a new branch.</li>
<li>Start an interactive rebase on <code>HEAD</code>.</li>
<li>Get the commits you want.</li>
<li>Review the commits you want.</li>
<li>Execute the rebase.</li>
<li>Repeat step 1 until all commits are distributed to the differing branches.</li>
</ol>
<p>Now that you have 5 small requests to review instead of a single big one, your colleagues will hopefully have an easier time approving the changes you’ve made.</p>
<hr style="border-top: 1px solid #9D9D9D ; color: #9D9D9D ;" class="endpost">
<div class="row sharebutton"><ul class="wrapper"><li class="title">Share</li></ul></div>
<div class="day-quote">
<div class="title"></div>
<div class="content"></div>
</div>
<div class="row author">
<div class="col-sm-2 image"> <img class="img-responsive center-block" src="https://haniyya.github.io/assets/images/author/logo_export.svg" alt="">
</div>
<div class="col-sm-10 bio">
<p class="title">Author</p>
<p class="name">Paul</p>
<p class="content">Independent Webdeveloper based in Kiel, Germany. Come read my stuff!</p>
</div>
</div>
<div class="disqus" id="comments">
<div class="title"><h3>
<i class="fa fa-comments" aria-hidden="true"></i> Leave a comment on this post</h3></div>
<div class="content">
<div id="disqus_thread"></div>
<script> var disqus_shortname = "brewing-bits-com"; var disqus_config = function () { if(typeof(this.page) == "undefined"){ this.page = {}; }; this.page.url = "https://brewing-bits.com/blog/splitting-big-merges/"; this.page.identifier = "/blog/splitting-big-merges/"; this.page.title = "A way to split up big merge- or pull-requests"; }; (function() { var d = document, s = d.createElement("script"); s.src = "https://brewing-bits-com.disqus.com/embed.js"; s.setAttribute("data-timestamp", +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
</div>
</div>
</div></article></div>
</div></div>
<div class="footer"><div class="container-fluid"><div class="row-fluid">
<div class="col-sm-4 copyright"> <span>Brewing Bits © 2016-2020 • All right reserved.</span>
</div>
<div class="col-sm-4 message"> <span>Brewing delicious lines of code.</span>
</div>
<div class="col-sm-4 madeby"> <span>Made with <a href="https://jekyllrb.com" target="_blank">Jekyll</a> using <a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a> Theme.</span>
</div>
<a class="pull-right top" href="#top"><i class="fa fa-caret-up" aria-hidden="true"></i></a>
</div></div></div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script src="https://haniyya.github.io/assets/javascripts/jekyll-spotify-plugin.min.js"></script> <script type="text/javascript" src="https://haniyya.github.io/assets/javascripts/post.js"></script> <script type="text/javascript"> jQuery(document).ready(function($) { $('.post > .row.content a').addClass('ga-event'); $('.page.spage > .row.content th a').addClass('ga-event'); $('.row.content li a').removeClass('ga-event'); $('a.ga-event').attr('onclick', 'ga(\'send\',\'event\',\'linkTo\',this.href,\'https://haniyya.github.io/blog/splitting-big-merges/\');'); }); </script> <script src="https://haniyya.github.io/assets/javascripts/global.js"></script>
</body>
</html>
